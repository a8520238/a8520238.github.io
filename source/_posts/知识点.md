---
title: 知识点
date: 2021-2-28
cover:
top_img:
categories: 分布式
tags: 
mathjax: true
katex: true
---
# 1 rpc和http的区别

> http是指从客户端到服务器端的请求消息，rpc是远程过程调用协议。

1. rpc和http的区别
- http请求是使用具有标准语义的通用的接口定向到资源，这些语义能够被中间组件和提供服务的来源机器进行解释。
- rpc是根据语言的API来定义的，不是根据基于网络的应用来定义的。
- rpc是基于tcp/ip的，rpc将原来的本地调用转变为调用远端的服务器上的方法。步骤如下：
    - 客户端以本地调用方式调用接口
    - 客户端存根接受到调用后，负责将方法、参数等组装成能够进行网络传输的消息体（将消息对象序列化为二进制）；
    - 客户端通过sockets将消息发送到服务端
    - 服务端存根（server stub）收到消息后进行解码（将消息对象反序列化）；
    - 服务端存根（server stub）根据解码结果调用本地的服务；
    - 本地服务执行并将结果放回给服务端存根（server stub）；
    - 服务端存根（server stub）将返回结果打包成消息（将结果消息对象序列化）；
    - 服务端（server）通过sockets将消息发送到客户端
    - 客户端存根（client stub）接手到结果消息，并进行解码（将结果消息发序列化）；
    - 客户端最终得到结果
2. 传输协议对比
- rpc可以基于tcp协议，也可以基于HTTP协议。基于HTTP协议
3. 传输效率
- rpc使用自定义的tcp协议，可以让请求报文体积更小，或者使用HTTP2协议，也可以很好的减少报文的体积，提高传输效率。
- http:如果是基于HTTP1.1的协议，请求中会包含很多无用的内容，如果是基于HTTP2.0，那么简单的封装以下是可以作为一个RPC来使用，这时标准RPC框架更多的是服务治理。
4. 性能消耗
- RPC：可以基于thrift实现高效的二进制传输
- HTTP：大部分是通过json来实现的，字节大小和序列化耗时都比thrift更消耗性能
5. 负载均衡
- RPC: 基本都自带了负载均衡策略
- HTTP：需要配置nginx，HAProxy来实现
6. 总结
- RPC主要用于公司内部的服务调用，性能消耗低，传输效率高，服务治理方便。
- HTTP主要用于对外的异构环境，浏览器接口调用，APP接口调用，第三方接口调用等。