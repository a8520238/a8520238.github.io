---
title: 自动装箱
date: 2021-2-28
cover:
top_img:
categories: javaSE
tags: 
mathjax: true
katex: true
---
# 自动装箱

## 1 基本数据类型有什么好处

- new的对象是存储在堆里，我们通过栈中的引用来使用这些对象。
- Java提供了基本数据类型，这种数据的变量不需要使用new创建，他们不会再堆上创建，而是直接在栈内存中存储。

## 2 为什么不能用浮点型表示金额

计算机中保存的小数其实是十进制的小数的近似值，并不是准确值。建议使用BigDecimal或者Long。

## 3 包装类型

- byte        Byte
- boolean     Boolean
- short       Short
- char        Character
- int         Integer
- long        Long
- float       Float
- double      Double

## 4 自动拆箱装箱

例子如下

```
  public static  void main(String[]args){
        Integer integer=1; //装箱
        int i=integer; //拆箱
    }
```
反编译后
```
public static  void main(String[]args){
        Integer integer=Integer.valueOf(1);
        int i=integer.intValue();
    }
```


##  5 Integer类型的缓存

- 如果在 -128至127之间，Integer a == Integer b 会为true,因为在常量池中会有缓存，超过会直接比较对象的引用，会返回false；可以通过设置java.lang.Integer.IntegerCache来设计最大值。
```
  public static Integer valueOf(int i) {
        if (i >= IntegerCache.low && i <= IntegerCache.high)
            return IntegerCache.cache[i + (-IntegerCache.low)];
        return new Integer(i);
    }
```


如果超过该范围想要比较大小，只能通过equals进行比较。
- 其他缓存对象

有ByteCache用于缓存Byte对象

有ShortCache用于缓存Short对象

有LongCache用于缓存Long对象

有CharacterCache用于缓存Character对象

## 8 boolean和Boolean 以及 success还是isSuccess

- success还是isSuccess

阿里巴巴Java开发手册中，有一个强制性规定：
POJO类中布尔类型的变量，都不要加is，否则部分框架解析会引起序列化错误。

根据JavaBeans规范，如果定义变量名为isSuccess, 生成的get应为，isisSuccess,但是很多IDE仍会生成isSuccess,这会对序列化和反序列化产生影响。如下所述：

```
Serializable Result With fastjson :{"success":true}
Serializable Result With Gson :{"isSuccess":true}
Serializable Result With jackson :{"success":true}
```

fastjson和jackson在把对象序列化成json字符串的时候，是通过反射遍历出该类中的所有getter方法，得到getHollis和isSuccess，然后根据JavaBeans规则，他会认为这是两个属性hollis和success的值。直接序列化成json:{"hollis":"hollischuang","success":true}

但是Gson并不是这么做的，他是通过反射遍历该类中的所有属性，并把其值序列化成json:{"isSuccess":true}

可以看到，由于不同的序列化工具，在进行序列化的时候使用到的策略是不一样的，所以，对于同一个类的同一个对象的序列化结果可能是不同的。

- Boolean 还是boolean

Alibaba开发者手册中:
1. 强制所有的POJO类属性必须使用包装类
2. 强制RPC方法的返回值和参数必须使用包装类
3. 推荐所有的局部变量使用基本数据类型

应尽量使用Boolen包装类，原因如下：

包装类的默认值是null，如果是null很多地方会检查，增加安全性。

# 9 在使用自动装箱时, 会复用[-128,127]之间的Integer对象。

```
Integer  a1 = 1;
Integer  a2 = 1;
Integer  a3 = new Integer(1);
//会打印true，因为a1和a2是同一个对象,都是Integer.cache[129]
System.out.println(a1 == a2);
//false，a3构造了一个新的对象，不同于a1,a2
System.out.println(a1 == a3);
```