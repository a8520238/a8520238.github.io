---
title: 网络层
date: 2021-2-28
cover:
top_img:
categories: 计算机网络
tags: 
mathjax: true
katex: true
---
# 网络层

网络层能够被分解为两个相互作用的部分，即数据平面和控制平面。

数据平面的主要作用是从其输入链路向其输出链路转发数据报；控制平面的主要作用是协调这些本地的路由器转发动作，使得数据报沿着源和目的地主机之间的路由器路径最终进行端到端传输。

转发和路由选择：数据平面和控制平面

转发是指将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作。（硬件）

路由选择是指确定分组从源到目的地所采取的端到端路径的网络范围处理过程。（软件）

路由器工作原理

网际协议：IPv4、寻址、IPv6及其他， IP地址属于网络层地址， IP属于面向无连接型

# 1 IPv4
## 1.1 IPV4数据报格式
![](http://note.youdao.com/yws/public/resource/ee0240bc38d981dd714fac885bebb768/xmlnote/B1B01B5371E045A6B3AD6EE8730293FF/14238)
- 版本号。由4比特构成，表示标识IP首部的版本号。字段值为4。
- 首部长度。由4比特构成，表明IP首部的大小。因为IPv4包含一些可变数量的选项。
- 服务类型（Tos字段）。由8比特构成，表明服务质量。（优先级、时延、吞吐量）
- 数据报长度。由16比特构成，表示IP数据报的总长度。
- 标识。由16比特构成。用于分片重组。同一个分片的标识值相同，不同分片的标识值不同。
- 标志。由3比特构成。表示包被分片的相关信息。
- 片偏移。由13比特构成。用来表示被分片的每一个分段相对于原始数据的位置。
- 生存时间（Time To Live，TTL）。由8比特构成。表示可以中转多少个路由器，每经过一个路由器，TTL会减少1，直到变成0则丢弃该包。
- 上层协议。由8比特构成，表示IP数据报的数据部分应该交给哪个协议。
- 首部检验和。由16比特构成，校验数据报的首部，不校验数据部分。用来确保IP数据报不被破坏。
- 源地址。由32比特构成，表示发送端IP地址
- 目标地址。由32比特构成，表示接受端IP地址
- 可选项。 长度可变，在实验或诊断时使用，包括安全级别、源路径、路径记录、时间戳。
- 数据。存入数据。包括IP上层协议的首部
> ipv4首部最小20字节，最大60字节。ipv6固定40字节
## 1.2 IPv4数据报分片

一个链路层帧能承载的最大数据量叫作最大传送单元（Maximun Transmission Unit， MTU）。每种数据链路的最大传输单元都不近相同。

路由器将IP数据报分片但不会进行重组，重组只能由目标主机进行。

## 1.3 Ipv4编址
主机与物理链路之间的边界叫接口。一个IP地址与一个接口相关联，而不是与包括该接口的主机或路由器相关联。

IPv4地址由32位比特组成。每8位分成一组，分成4组，以”.”隔开，再将每组数转化为十进制数。

IPv4地址由网络标识（网络地址）和主机标识（主机地址）两部分组成。

子网掩码将原网络分为多个物理网络。[子网掩码详解](https://blog.csdn.net/gatieme/article/details/50989257)

物件别域间路由选择（Classless Interdomain Routing， CIDR） 和
可变长子网掩码（Variable Length Subnet Mask， VLSM）技术采用任意长度分割IP地址的网络标识和主机标识。

广播地址。把IP地址中的主机地址部分全部设置为1，就成了广播地址。
在本网络内的广播叫本地广播，不同网络之间的广播叫直接广播。

多播。多播用于将包发送给特定组内的所有主机。

对于没有连接互联网的独立网络中的主机，只要保证在这个网络每地址唯一，可以不用考虑互联网即可配置响应的IP地址。私有网络的IP地址
- A类 10.0.0.0 ~ 10.255.255.255（10/8）
- B类 172.16.0.0 ~ 172.31.255.255（172.16/12）
- C类 192.168.0.0 ~ 192.168.255.255（192.168/16）

包含在这个范围内的IP地址都属于私有IP，在此之外的IP称为全局IP。

# 2 Ipv6

## 2.1 IPv6数据报格式
![](http://note.youdao.com/yws/public/resource/ee0240bc38d981dd714fac885bebb768/xmlnote/04C7048AF63C47A8802A06CA5B466098/14240)
- 版本。 由4比特构成。6.
- 流量类型 由8比特构成。与IPv4中TOS字段含义相似。
- 流表签 由20比特构成。用于标识一条数据报的流。
- 有效载荷长度 由16比特构成。有效载荷指包的数据部分。
- 下一个首部 由8比特构成，相当于IPv4的协议字段
- 跳限制 由8比特构成，相当于IPv4的TTL。
- 源地址 由128比特构成。表示发送端IP地址
- 目的地址 由128比特构成。表示接受端IP地址。
1. IPv4数据报的几个字段不复存在：
    - 分片/重新组装： IPv6不允许在中间路由器上进行分片与重新组装。这种操作只能在源与目的地执行。
    - 首部检验和： IP分组关注的重点是快速处理。减轻路由器负荷。
    - 选项： 选项字段不再是首部的一部分，但他没有消失，可能出现在“下一个首部”指出的位置上。
2. IPv6的必要性
    - 解决IPv4地址耗尽的问题
    - 弥补IPv4中的大多数缺陷
3. IPv6的特点
    - IP地址的扩大与路由控制表的聚合
    - 性能提升：包首部采用固定的值（40字节），不再采用首部检验码，简化首部结构，减轻路由器负荷。路由器不再做分片处理。
    - 支持即插即用功能：即使没有DHCP服务器也可以实现自动分配IP地址
    - 采用认证与加密功能：应对伪造IP地址的网络安全功能以及防止线路窃听的功能（IPsec）
    - 多播、MobileIP称为扩展功能

