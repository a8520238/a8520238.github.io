---
title: 线程组和优先级
date: 2021-2-28
cover:
top_img:
categories: java并发编程
tags: 
mathjax: true
katex: true
---
# 2 线程组和优先级


## 2.1 线程组ThreadGroup
线程组是一个树状的结构，每个线程组下面可以有很多多线程或者线程组

- 线程依赖于线程组而存在
- 线程组可以统一控制线程的优先级和检查线程的权限
- 线程组中的线程只允许访问自己所在线程组的信息，不允许访问其它线程组的信息，包括父线程组或其他任何线程组。
> 创建新线程时，若没有显式指定所属线程组，则将父线程所在的线程组作为自己的线程组。

### 2.1.1 线程组方法
- 新建线程组：ThreadGroup threadGroup = new ThreadGroup("name");
- 获取当前线程组：Thread.currentThread().getThreadGroup()

### 2.1.2 ThreadGroup成员变量
```
public class ThreadGroup implements Thread.UncaughtExceptionHandler {
    private final ThreadGroup parent;//父线程组
    String name;//线程组名称
    int maxPriority; // 线程最大优先级
    boolean destroyed; // 是否已被销毁
    boolean daemon; // 是否为守护线程
    boolean vmAllowSuspension; // 是否允许中断
    int nUnstartedThreads = 0; // 还未启动的线程数目
    int nthreads; // ThreadGroup 中线程数目
    Thread threads[]; // ThreadGroup 中的线程数组
    // 一个线程组可以包含其他线程组
    int ngroups; // 下属的线程组数目
    ThreadGroup groups[]; // 下属的线程组数组
}
```
### 2.1.3 中断
线程组被中断，其中所有线程都中断

## 2.2 优先级
java线程优先级范围：1-10，可以自己设定
- 该优先级只是给操作系统一个参考值，最终优先级决定权在于操作系统，依赖于具体的线程调度算法。
- 默认线程优先级为5.
- Thread类的实例方法setPriority（优先级）方法来设置优先级。

### 2.2.1 线程调度器

Java线程调度器来监视和控制处于Runnable状态的线程。
线程的调度策略采用抢占式。
- 优先级高的优先执行
- 优先级相同时，先到先得
### 2.2.2 守护线程Daemon
Java中存在两类线程：
- 用户线程：平常所创建的线程
- 守护线程：为用户线程服务的线程
    + 若存在任意的非守护线程，则守护线程仍工作
    + 当所有非守护线程结束时，则守护线程也自动结束，JVM退出。

在线程start()前，可以设置守护线程thread.setDaemon(true)
- Daemon线程的子线程也是Daemon现场
- Daemon线程不能访问固有资源，比如读写或计算等。因为它随时可能被中断。

1. 守护线程的作用

当JVM中不存在任何一个正在运行的非守护线程时，则JVM进程即会退出。

换句话说如果有非守护线程在后台运行，JVM就无法正常退出。
- 守护线程拥有自动结束自己生命周期的特性，而非守护线程不具备这个特点。
- 所以守护线程经常被用来执行一些后台任务，如果我们希望程序退出时，或者说JVM退出时，线程能够自动关闭，守护线程是首选。比如垃圾回收线程。

2. 守护线程永远不去访问固有资源，如文件，数据库，不会进行读写操作或者计算逻辑，因为它会在任何时候发生中断。