---
title: 进程与线程相关知识点
date: 2021-2-28
cover:
top_img:
categories: 操作系统
tags: 
mathjax: true
katex: true
---
# 一、进程与线程区别

1、进程是资源分配的最小单位，线程是资源执行的最小单位（CPU分配时间的单位）。线程是进程的子任务，每个进程包含多个线程。

2、进程有自己的独立地址空间，每一个进程有独立的地址空间，更换操作代价昂贵（数据共享复杂），但是同步简单。线程共享进程的地址空间，切换和创建线程的开销小，但是同步复杂。

3、线程之间通讯方便，同一进程下线程共享全局变量、静态变量数据。而进程之间的通讯要以通讯的方式(ipc)进行。

4、多进程更加健壮，一个进程死了不会影响其他进程，而多线程会互相影响。

5、进程是重量级的，而线程是轻量级的。进程的创建和销毁不仅需要保存寄存器和栈信息，还需要资源的分配回收以及页调度，开销较大；线程只需要保存寄存器和栈信息，开销较小。

# 二、进程中线程的共享和不共享信息

线程管理：

将线程共有的信息存放在进程控制块中，将线程独有的信息存放在线程控制块中。

那么如何区分哪些信息是共享的？哪些信息是独享的呢？

一般的评价标准是：如果某些资源不独享会导致线程运行错误，则该资源就由每个线程独享，而其他资源都由进程里面的所有线程共享。

![线程和进程共享信息](https://note.youdao.com/yws/public/resource/48c8f55a5e8491c6959ae977e7f8a4d1/xmlnote/8D1C5B769A1C4D4AA69792AF47DCB390/2012)

一般情况下进程共享资源与独享资源的划分

那么对于进程及线程的实现做如何解释呢？

首先应该明白进程的调度，创建等实质上都是由操作系统实现的，所以说进程的实现只能由操作系统内核来实现，而不存在用户态实现的情况。但是对于线程就不同了，线程的管理者可以是用户也可以是操作系统本身，线程是进程内部的东西，当然存在由进程直接管理线程的可能性。因此线程的实现就应该分为内核态线程实现和用户态线程实现。

# 三、进程和线程在Linux中区别不大

详见 https://github.com/jiajunhua/labuladong-fucking-algorithm/blob/master/%E6%8A%80%E6%9C%AF/linux%E8%BF%9B%E7%A8%8B.md

 Linux 中的进程就是一个数据结构，看明白就可以理解文件描述符、重定向、管道命令的底层工作原理，最后我们从操作系统的角度看看为什么说线程和进程基本没有区别。
 
 ## 3.1 进程（Linux）
 
 每个进程都有它的固有属性，比如进程号（PID）、进程状态、打开的文件等等，进程创建好之后，读入你的程序，你的程序才被系统执行。

# 四、 上下文切换

上下文指的是某一时间点的CPU寄存器和程序计数器的内容。

上下文切换是指CPU从一个进程（线程）切换到另一个进程（线程）。

CPU为某个线程分配CPU时间片来实现多线程机制，CPU通过时间片分配算法来循环执行任务，当前任务执行一个时间片后会切换到下一个任务。

- 在任务切换前会保存上一个任务的运行状态，该任务从保存到加载的过程就是一次上下文切换。

# 5 多线程

进程在多数早期多任务操作系统中是执行工作的基本单元。进程是包含程序指令和相关资源的集合，每个进程和其他进程一起参与调度，竞争CPU、内存。每次进程的切换都存在进程资源的保护和恢复动作，这称为上下文切换。进程的引入可以解决多用户支持的问题，但也引入了新的问题：进程频繁切换可能严重影响性能。

同一个进程内部可能有多个线程，共享一个进程的所有资源。通过线程支持了同一应用程序内部的并发，免去了进程频繁切换的开销，另外并发任务间通信也更简单。

一个栈中只有最下方的栈可被读写，相应的也只有这个栈对应的函数被激活，处于工作状态。为了实现多线程，必须绕开栈的限制。这样多个多个线程就有了多个函数栈，每个栈对应一个线程。

## 5.1 线程的属性
1. 线程是一个轻型实体，不拥有系统资源，但每一个线程应有一个唯一的标识符和一个线程控制块，线程控制块记录了线程执行的寄存器和栈等现场状态。
2. 不同的线程可以执行相同的程序，即同一个服务程序被不同的用户调用时，操作系统为他们创建不同的线程
3. 同一进程中的各个线程共享该进程所拥有的资源
4. 线程是处理机的独立调度单位，多个线程是可以并发执行的。

## 5.2 多线程同步
- 互斥锁
- 条件变量
- 读写锁
- 信号量
- 多线程重入