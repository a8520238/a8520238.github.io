---
title: Dubbo
date: 2021-2-28
cover:
top_img:
categories: 分布式
tags: 
mathjax: true
katex: true
---
Dubbo是一款高性能的Java RPC框架

[ZooKeeper+Dubbo分布式架构基础教程](https://www.bilibili.com/video/BV1BA411q7ia?p=72)
1. 面向接口的的远程方法调用，智能容错和负载均衡，服务自动注册和发现
# 1 RPC
- A服务器的方法调用B服务器的方法，不在同一个内存空间。
    1. 客户端调用
    2. 序列化
    3. 发送消息
    4. 发序列化
    5. 调用本地服务
    6. 服务处理
    7. 返回结果
    8. 将结果序列化
    9. 返回消息
    10. 反序列化
    11. 返回调用结果
# 2 RMI
- java原生支持的远程调用，采用JRMP作为通信协议
- client、server、registy注册中心
1. 大致原理：服务端在注册中心注册服务，客户端从注册中心获取服务具体信息，客户端调用服务端执行服务。
2. 步骤
    1. 创建远程接口，继承Remote
    2. 实现远程接口，并且继承UnicastRemoteObject
    3. 启动RMI注册服务，指定端口号
    4. 创建要被访问的远程对象的实例
    5. 把远程对象实例注册到RMI注册服务器上

# 3 dubbo高可用
1. 服务路由（包含一条路由规则）
    - dubbo提供了三种服务路由实现（条件路由ConditionRouter、脚本路由ScriptRouter、标签路由TagRouter）
2. 条件路由规则的格式：
    - 服务消费者匹配条件 => 服务提供者匹配条件
    - host = 10.20.153.10 => host = 10.20.153.11
    - 该条规则表示IP为10.20.153.10的服务消费者止咳调用IP为10.20.153.11机器上的服务，不可调用其他机器上的服务。
    - 如果服务消费者匹配条件为空，表示不对服务消费者进行限制。如果服务提供者匹配条件为空，表示对某些服务消费者禁用服务。
    - 包括黑名单、白名单、读写分离、前后天分离
3. 集群容错
    - FailoverCluster,某个服务器产生异常，重试其他服务器，可以设置重试次数。
    - Failfast Cluter快速失败，只调用一次，立即报错。通常用于非幂等性的写操作
4. 负载均衡（面试题）
    - 随机权重分配，无状态
    - 轮训服务器，有状态
    - 活跃计数器随机
    - 一致性哈希，为IP分配固定的服务器
5. dubbo降级服务
    - 服务降级就是指在由于非主业务异常导致的服务不可用时（服务器宕机/网络超时/并发数太高等），可以返回默认值，避免异常影响主业务的处理

> zookeeper 和 redis 用于消息中心的很重要的原因是知道断开

Dubbo SPI流程：名字-->文件-->实现类-->对象-->依赖注入-->AOP-->完整的一个对象

> Dubbo的依赖注入与spring的区别，注入的是一个属性的代理对象，根据实际要用时传入的url中的实际对象赋真正的值，也就是set的时候并没有确定最终的对象。